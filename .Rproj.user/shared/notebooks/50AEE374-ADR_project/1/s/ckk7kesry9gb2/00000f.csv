"0","library(quantreg)"
"0","library(gridExtra)"
"0","library(dplyr)"
"0",""
"0","# Simulate basic heteroskedastic data"
"0","set.seed(666)"
"0","n <- 500"
"0","X <- runif(n, 0, 10)"
"0","epsilon <- rnorm(n, mean = 0, sd = 1 + 0.3 * X)"
"0","Y <- 5 + 1.5 * X + epsilon"
"0","data <- data.frame(X = X, Y = Y)"
"0",""
"0","# Fit models"
"0","ols_fit <- lm(Y ~ X, data = data)"
"0","rq_10 <- rq(Y ~ X, tau = 0.1, data = data)"
"0","rq_50 <- rq(Y ~ X, tau = 0.5, data = data)"
"0","rq_90 <- rq(Y ~ X, tau = 0.9, data = data)"
"0",""
"0","# Plot 1: Scatterplot + regression lines"
"0","p1 <- ggplot(data, aes(x = X, y = Y)) +"
"0","  geom_point(alpha = 0.4) +"
"0","  geom_smooth(method = ""lm"", se = FALSE, color = ""red"", linetype = ""dashed"") +"
"0","  geom_quantile(quantiles = c(0.1, 0.5, 0.9), color = ""blue"", size = 0.8) +"
"0","  labs(title = ""OLS vs Quantile Regression Lines"", y = ""Y"", x = ""X"") +"
"0","  theme_minimal()"
"2","Aviso: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
Please use `linewidth` instead."
"0","# Plot 2: Slope across quantiles"
"0","taus <- seq(0.05, 0.95, by = 0.05)"
"0","slopes <- sapply(taus, function(tau) coef(rq(Y ~ X, tau = tau))[2])"
"0","p2 <- ggplot(data.frame(tau = taus, slope = slopes), aes(x = tau, y = slope)) +"
"0","  geom_line(color = ""blue"") +"
"0","  geom_hline(yintercept = coef(ols_fit)[2], linetype = ""dashed"", color = ""red"") +"
"0","  labs(title = ""Slope estimates across quantiles"", y = ""Slope"", x = ""Quantile (tau)"") +"
"0","  theme_minimal()"
"0",""
"0","# Plot 3: Robustness to outliers"
"0","data_outlier <- data"
"0","idx <- sample(1:n, 10)"
"0","data_outlier$Y[idx] <- data_outlier$Y[idx] + 50  # Add strong outliers"
"0",""
"0","ols_fit_outlier <- lm(Y ~ X, data = data_outlier)"
"0","rq_50_outlier <- rq(Y ~ X, tau = 0.5, data = data_outlier)"
"0",""
"0","p3 <- ggplot(data_outlier, aes(x = X, y = Y)) +"
"0","  geom_point(alpha = 0.4) +"
"0","  geom_smooth(method = ""lm"", se = FALSE, color = ""red"", linetype = ""dashed"") +"
"0","  geom_abline(intercept = coef(rq_50_outlier)[1], slope = coef(rq_50_outlier)[2], color = ""blue"") +"
"0","  labs(title = ""Effect of Outliers: OLS vs Median QR"", y = ""Y"", x = ""X"") +"
"0","  theme_minimal()"
"0",""
"0","# Plot 4: Residuals histograms"
"0","residuals_ols <- resid(ols_fit)"
"0","residuals_rq50 <- resid(rq_50)"
"0",""
"0","residuals_df <- data.frame("
"0","  residuals = c(residuals_ols, residuals_rq50),"
"0","  Method = rep(c(""OLS"", ""QR (tau=0.5)""), each = n)"
"0",")"
"0",""
"0","p4 <- ggplot(residuals_df, aes(x = residuals, fill = Method)) +"
"0","  geom_histogram(alpha = 0.5, position = ""identity"", bins = 30) +"
"0","  facet_wrap(~Method) +"
"0","  labs(title = ""Residuals Distribution: OLS vs QR"", x = ""Residuals"", y = ""Count"") +"
"0","  theme_minimal()"
"0",""
"0","# Arrange in grid (2x2 layout)"
"0","grid.arrange(p1, p2, p3, p4, nrow = 2)"
